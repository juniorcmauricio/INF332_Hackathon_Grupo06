ðŸ“ Project structure
hackapi/
 â”œâ”€ app/
 â”‚   â”œâ”€ main.py
 â”‚   â”œâ”€ config.py
 â”‚   â”œâ”€ models.py
 â”‚   â”œâ”€ services/
 â”‚   â”‚    â””â”€ recommendation_service.py
 â”‚   â”œâ”€ clients/
 â”‚   â”‚    â””â”€ tmdb.py
 â”‚   â””â”€ ai/
 â”‚        â”œâ”€ genre_mapper.py
 â”‚        â””â”€ hf_zero_shot.py
 â”œâ”€ movieapi.env               â† environment variables live here
 â”œâ”€ requirements.txt
 â””â”€ README.md

âš™ï¸ 1. Create the virtual environment

Open a terminal (PowerShell, cmd, or bash) inside the project root:

# Create virtual environment
python -m venv .venv

# Activate it
# On Windows (PowerShell)
.venv\Scripts\Activate.ps1
# On Linux/macOS
source .venv/bin/activate


Your prompt should now show (.venv) at the start.

ðŸ“¦ 2. Install dependencies

ðŸ’¡ Base install is lightweight â€” no heavy ML unless you want local AI.

pip install --upgrade pip
pip install -r requirements.txt


If you donâ€™t have requirements.txt yet:

pip install fastapi uvicorn httpx pydantic-settings cachetools tenacity python-dotenv
pip freeze > requirements.txt

ðŸ”‘ 3. Configure the environment file

Create or edit a file named movieapi.env at the project root (same folder as app/):

# TMDB API (required)
HACK_MOVIES_API_BASE=https://api.themoviedb.org/3
HACK_TMDB_V3_KEY=YOUR_TMDB_V3_KEY_HERE

# Choose how AI runs: local | remote | off
HACK_AI_MODE=remote

# Hugging Face Inference API (only for remote mode)
HACK_HF_API_KEY=hf_your_hf_token_here
HACK_HF_MODEL=facebook/bart-large-mnli


ðŸ§© Tips:

Do not rename this file â€” it must stay as movieapi.env for the loader to work.

Never commit it to Git (itâ€™s in .gitignore).

Get your TMDB v3 key at https://www.themoviedb.org/settings/api
.

Get your Hugging Face API token at https://huggingface.co/settings/tokens
.

ðŸš€ 4. Run the server

From your virtual environment:

uvicorn app.main:app --reload


Expected output:

Uvicorn running on http://127.0.0.1:8000

ðŸ§­ 5. Test the API

Open your browser or run:

# Health check
http://127.0.0.1:8000/health

# Debug IA + TMDB test
http://127.0.0.1:8000/_debug/checks?mood=feliz

# Movie recommendations
http://127.0.0.1:8000/recommendations?mood=um filme leve e inspirador


Or use the Swagger docs:
ðŸ‘‰ http://127.0.0.1:8000/docs

ðŸ§  6. (Optional) Local AI mode

If you want to run the AI locally (no external API calls):

pip install "transformers>=4.46" "torch==2.6.*" --index-url https://download.pytorch.org/whl/cpu


Then, in movieapi.env:

HACK_AI_MODE=local


âš ï¸ On Windows, install the Microsoft Visual C++ 2015â€“2022 Redistributable (x64) to fix DLL issues.

âš¡ 7. Environment modes summary
Mode	Extra packages	Behavior	Latency
off	none	uses static map only	âš¡ instant
remote	httpx	calls Hugging Face API	ðŸŒ depends on network
local	torch + transformers	runs zero-shot locally	ðŸ§® higher CPU load
ðŸ§° 8. Useful commands
Command	Description
deactivate	Exit the virtual environment
pip list	List installed packages
pip freeze > requirements.txt	Update dependency file
git status	Show versioned files
uvicorn app.main:app --reload	Run development server
ðŸ§¼ 9. Troubleshooting
Symptom	Fix
401 from TMDB	Check HACK_TMDB_V3_KEY inside movieapi.env
DLL load failed (torch)	Switch to HACK_AI_MODE=remote or reinstall VC++ runtime
.env not loading	Must be named movieapi.env and located at project root
Model load error	Upgrade Torch to â‰¥2.6 or switch to remote
Packages mismatch	pip cache purge && pip install -r requirements.txt